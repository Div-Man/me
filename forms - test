<?php
error_reporting(-1);
ini_set('display_errors', 'On');

if(isset($_GET['test'])){
	$getParametr = true;
	if (file_exists('test/' . $_GET['test'])){
		$file = file_get_contents('test/'. $_GET['test'], true);
	}
	elseif(!file_exists('test/' . $_GET['test'])){
		echo 'Такого теста не существует';
		die();
	}
	else{
		echo 'Такого теста не существует';
		die();
	}
	
	$decode = json_decode($file, true);
	
	$primer = $decode["calculate"]["description"];
	$answer = $decode["calculate"]["result"];
	$type = $decode["calculate"]["input"]["type"];
	
	$fp = fopen('answer.txt', 'w'); 
	
	$test = fwrite($fp, $answer); 
	fclose($fp);
}

else{
	$getParametr = false;
}

if(isset($_GET['sum'])){
	$file = file_get_contents('answer.txt', true);
	
	if($_GET['sum'] == $file){
		echo 'Ответ правильный';
		die();
	}
	else{
		echo 'Ответ не правильный';
		die();
	}
}
?>

<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Генератор тестов</title>
	</head>
<body>
<?php
	if(!isset($_GET['test'])){
		$message = 'Вы напрямую открыли эту страницу, для того, ';
		$message .= 'что бы увидеть контент, воспользуйтесь ';
		$message .= 'страницей <a href="list.php">list.php</a> ' ;
		$message .= 'и перейдите по ссылкам.';
		echo $message;
	}
?>
	<?php 
		if(isset($_GET['test'])){
			echo '<h2>Решите пример</h2>';
		}
	?>
	<form action="" method="get">
		<label for="sum">
		
		<?php if($getParametr) {
				echo $decode["calculate"]["description"];
			} 
			else die();
		?>
		</label>
		<input type="<?php echo $type?>" name="sum" id="sum">
		<input type="submit" value="Проверить">
	</form>
	<?php
	
	if(isset($_GET['test'])){
			echo '<p><a href="list.php">Вернутся к выбору теста</a> | <a href="admin.php">Загрузить новый</a></p>';
		}
	?>	
</body>
</html>
